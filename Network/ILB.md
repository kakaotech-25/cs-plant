# ILB (Internal Load Balancer)

## 로드 밸런서(Load Balancer)란?
- 네트워크 트래픽을 여러 서버나 인스턴스에 분산시키는 역할을 하는 네트워크 장치
### ILB(내부 로드 밸런서) vs ELB(외부 로드 밸런서)
- **ILB**: 내부 네트워크에서의 트래픽 관리 및 분산 처리
- **ELB**: 외부에서 들어오는 트래픽 처리

## ILB(Internal Load Balancer, 내부 로드 밸런서)란?
- 클라우드 환경에서 내부 네트워크 내에서만 접근 가능한 로드 밸런서
- 내부 리소스 간의 트래픽 관리 및 외부에서 직접 접근할 수 없는 내부 애플리케이션이나 서비스들 간의 트래픽 분산
- 클라우드 네트워크 내에서 서비스 간의 통신을 최적화하고 부하를 여러 서버로 분산하여 안정성을 향상시키고 응답 시간을 최소화하여 서버 선능 개선 가능
- 외부에 노출되지 않은 내부 서비스 간의 효율적인 통신과 트래픽 관리로 네트워크 성능 최적화 및 서비스 가용성 보장
- ex) MSA(마이크로서비스 아키텍처): 마이크로서비스 환경에서 각 서비스 간의 트래픽을 관리하고, 서비스 장애 시에도 다른 서비스가 영향을 받지 않도록 하는 데 사용

## ILB의 주요 기능
- **트래픽 분산 (로드 밸런싱)**: 여러 인스턴스나 서비스에 대한 트래픽을 균등하게 분산하여 과부하 방지 및 시스템 전체 성능 향상
- **보안 및 접근 제어**: 내부 네트워크 내에서만 작동 -> 외부의 공격으로부터 내부 자원 보호 가능
- **고가용성 지원**: 특정 인스턴스가 장애를 일으켰을 때도 서비스가 계속 가동될 수 있도록 지원
- **내부 리소스 간의 연결 관리**: 내부 리소스 간의 통신을 최적화하고 안정적인 연결을 유지 및 관리

## ILB의 작동 방식
### 클라이언트-서버 패킷 처리
1. ILB에서 클라이언트가 VIP 주소로 보낸 수신 요청을 받아 로드 밸런싱 규칙과 요청을 비교
2. ILB에서 일치하는 로드 밸런싱 규칙을 찾을 경우 로드 밸런싱 알고리즘을 사용하여 트래픽을 분산할 백엔드 서버를 선택하고 작동 모드에 따라 요청을 밴엔드 서버로 전달
3. ILB는 수정된 수신 요청을 선택된 백엔드 서버로 전달

### 서버-클라이언트 패킷 처리
1. 백엔드 서버가 클라이언트의 수신 요청을 처리하고 결과를 ILB로 응답을 보냄
2. ILB는 백엔드 서버로부터 응답을 받은 후 다시 클라이언트에게 전달 -> ILB의 작업은 **작동 모드**를 기반으로 하여 작동 모드에 따라 다르게 수행

> **작동 모드(Operation Mode)**: 특정 작업을 수행할 때 사용할 수 있는 여러 설정이나 방식 중 하나를 의미
>   - ILB의 작동 모드    
>      - **SNAT(Source Network Address Translation)**: ILB가 응답 트래픽의 소스 IP를 변경하여 클라이언트에게 응답을 전달하는 방식, 클라이언트는 ILB에서 응답이 온 것으로 인식
>      - **DSR(Direct Server Return)**: 응답 트래픽이 백엔드 서버에서 클라이언트로 직접 전달되는 방식, ILB는 요청만 처리하고 응답은 서버에서 직접 전달

> 패킷: 네트워크 상에서 데이터를 전송하기 위한 작은 단위의 정보   
> VIP(Virtual IP): 가상적으로 여러 서버나 장비에 할당되어 사용되는 IP 주소, 클라이언트가 서버의 물리적 위치나 실제 IP 주소를 알 필요 없이 서비스 사용 가능, 로드 밸런서가 사용하는 공용 IP  
> 로드 밸런싱 규칙(Load Balancing Rules): 로드 밸런서가 클라이언트 요청을 백엔드 서버에 어떻게 분배할지를 정의하는 방법    

## ILB 알고리즘
- 다양한 알고리즘을 통해 트래픽을 분산
- 트래픽을 여러 서버에 효과적으로 분산하여 시스템의 성능 최적화 및 특정 서버의 과부하 방지
### 라운드 로빈
- 서버 목록을 순환하며 들어오는 요청 순서대로 서버 그룹에 요청을 지정(분배)
- 서버에 요청이 지정되면 서버 목록 끝으로 서버 이동 -> 요청 받은 서버가 다음 순번에서 제외 -> 나머지 서버들이 먼저 요청을 받음
- 모든 서버에 트래픽이 균등하게 분배
### 소스 IP 해시
- 로드 밸런서가 수신 요청의 소스 IP 주소를 기준으로 특정 서버 선택
- 특정 IP 주소를 가진 클라이언트는 항상 동일한 서버로 연결
### 소스 IP 및 포트 해시
- 로드 밸런서가 수신 요청의 소스 IP 주소 및 소스 포트에 대한 해시 값을 기반으로 서버 선택
- 동일한 IP에서 다양한 애플리케이션을 사용하는 경우 유용
### 소스 IP 및 VIP 해시
- 로드 밸런서가 수신 요청의 소스 IP 주소 및 VIP(Virtual IP)에 대한 해시 값을 기반으로 서버 선택
- 클라이언트가 다양한 서비스(VIP)를 요청할 때 특정 서비스에 대해 일관된 서버를 선택하는 데 사용

> 소스 IP(src IP): 네트워크에서 특정 장치가 데이터를 전송할때 그 장치의 IP 주소   
> 소스 포트: 네트워크에서 클라이언트에서 사용되는 포트 번호   
> 해시: 데이터를 일정한 길이의 고정된 값으로 변환   
